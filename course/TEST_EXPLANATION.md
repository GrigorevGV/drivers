# Объяснение формата данных

## Почему видны нечитаемые символы?

Драйвер отправляет CAN фреймы в бинарном формате через UDP. Структура пакета:

```
struct can_eth_packet {
    __be32 can_id;        // 4 байта - CAN ID (big-endian)
    __u8 can_dlc;         // 1 байт - длина данных (0-8)
    __u8 flags;           // 1 байт - флаги (RTR, EFF)
    __u8 data[8];         // до 8 байт - данные CAN фрейма
}
```

## Пример расшифровки

Когда вы отправляете:
```bash
cansend vcan0 123#DEADBEEF
```

Драйвер создает UDP пакет с такой структурой:
- CAN ID: 0x00000123 (4 байта в big-endian: 00 00 01 23)
- DLC: 0x04 (4 байта данных)
- Flags: 0x00 (стандартный фрейм, не RTR)
- Data: DE AD BE EF (4 байта данных)

Полный пакет будет выглядеть в hex как:
```
00 00 01 23 04 00 DE AD BE EF
```

## Правильный способ тестирования

Используйте `hexdump -C` или `od` для просмотра бинарных данных. Из-за буферизации используйте один из вариантов:

**Вариант 1 (с отключением буферизации):**
```bash
stdbuf -o0 nc -u -l 12345 | hexdump -C
```

**Вариант 2 (через socat - работает лучше):**
```bash
socat -u UDP4-RECV:12345 - | hexdump -C
```

**Вариант 3 (сохранить в файл):**
```bash
nc -u -l 12345 > /tmp/can_data.bin
# После отправки CAN сообщения:
hexdump -C /tmp/can_data.bin
```

Вывод будет примерно таким:
```
00000000  00 00 01 23 04 00 de ad be ef                    |...#....|
00000009
```

Где:
- `00000000` - смещение в байтах
- `00 00 01 23 04 00 de ad be ef` - hex представление байтов
- `...#....` - ASCII представление (точки = непечатные символы)

## Пример полного теста

Терминал 1 (прием):
```bash
stdbuf -o0 nc -u -l 12345 | hexdump -C
```

Или через socat:
```bash
socat -u UDP4-RECV:12345 - | hexdump -C
```

Терминал 2 (отправка):
```bash
# Загрузите модуль
sudo insmod can_ethernet.ko can_interface_name=vcan0 remote_ip=127.0.0.1 remote_port=12345

# Отправьте CAN сообщение
cansend vcan0 123#DEADBEEF
```

В терминале 1 вы увидите:
```
00000000  00 00 01 23 04 00 de ad be ef                    |...#....|
```

## Проверка правильности передачи

Для проверки отправьте несколько разных сообщений:

1. `cansend vcan0 123#DEADBEEF` → Должно быть: `00 00 01 23 04 00 de ad be ef`
2. `cansend vcan0 456#CAFE` → Должно быть: `00 00 01 c8 02 00 ca fe`
3. `cansend vcan0 789#1122334455667788` → Должно быть: `00 00 03 15 08 00 11 22 33 44 55 66 77 88`

Обратите внимание:
- CAN ID всегда 4 байта (big-endian)
- DLC указывает количество байт данных (1-8)
- Flags обычно 0x00 для стандартных фреймов
- Данные следуют после флагов

